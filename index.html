<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Controle de Estoque</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
</head>
<body>

<div class="container">
    <header>
        <div>
            <h1>Estoque Geral (Firebase)</h1>
            <p id="data-atual"></p>
        </div>
        <button onclick="salvarLocal()" class="btn-save" style="width: auto; padding: 10px 20px;">â˜ï¸ Sincronizar Nuvem</button>
    </header>

    <div class="search-section">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h3>ğŸ” GestÃ£o de Busca</h3>
            <button onclick="toggleElement('areaFiltros')" class="btn-scan">Filtros AvanÃ§ados / Busca</button>
        </div>

        <div id="areaFiltros" style="display: none; margin-top: 15px; border-top: 1px solid #ccc; padding-top: 10px;">
            <input type="text" id="inputBusca" placeholder="CÃ³digo, DescriÃ§Ã£o ou CÃ³digo de Barras..." onkeyup="buscar()" style="width: 100%; margin-bottom: 10px;">
            
            <div class="form-group" style="margin-bottom: 10px;">
                <input type="text" id="filtroFornecedor" placeholder="Filtrar por Fornecedor">
                <input type="text" id="filtroGrupo" placeholder="Filtrar por Grupo">
                <input type="number" id="filtroValor" placeholder="Valor mÃ¡ximo (R$)">
                <button class="btn-save" onclick="aplicarFiltros()" style="margin-top:0">ğŸ” Executar Filtros</button>
            </div>
            <div style="display: flex; gap: 10px;">
                <button class="btn-scan" onclick="iniciarScanner('busca')">ğŸ“· Scan Barra</button>
                <button onclick="renderizarTabela()" style="background:none; color:var(--accent); text-decoration:underline; font-size:12px; border:none; cursor:pointer;">Limpar Todos os Filtros</button>
            </div>
        </div>

        <div style="margin-top: 10px; border-top: 1px dashed #ccc; padding-top: 10px;">
            <button onclick="prepararConferencia()" class="btn-save" style="background: #8e44ad;">ğŸ“¦ ConferÃªncia por Fornecedor</button>
            
            <div id="areaConferencia" style="display: none; margin-top: 15px; background: #fff; padding: 15px; border-radius: 8px; border: 2px solid #8e44ad;">
                <h4>Checkout de Fornecedor</h4>
                <select id="selectFornecedorConf" onchange="iniciarCheckout()" style="width: 100%; margin-bottom: 10px;">
                    <option value="">Selecione um Fornecedor...</option>
                </select>

                <div id="controleCheckout" style="display: none;">
                    <div style="display: flex; gap: 5px; margin-bottom: 10px;">
                        <input type="text" id="inputManualConf" placeholder="Bipe ou digite CÃ³d/Desc..." style="flex-grow: 1;">
                        <button class="btn-scan" onclick="iniciarScanner('conferencia')">ğŸ“·</button>
                        <button class="btn-add" onclick="processarBipeManual()" style="padding: 5px 15px;">OK</button>
                    </div>
                    <div id="listaCheckoutPendente"></div>
                    <button id="btnPdfConf" class="btn-pdf" onclick="gerarPDFConferencia()" style="display:none; width: 100%; background: #27ae60;">ğŸ“„ Gerar RelatÃ³rio de ConferÃªncia</button>
                </div>
            </div>
        </div>
    </div>

    <div id="interactive" class="viewport"></div>

    <div style="margin-bottom: 20px;">
        <button onclick="toggleElement('areaCadastro')" class="btn-add full-width" style="margin-bottom: 10px;">â• NOVO PRODUTO</button>
        
        <div id="areaCadastro" style="display: none; background: #f9f9f9; padding: 15px; border-radius: 8px; border: 1px solid #ddd;">
            <div class="form-group">
                <input type="text" id="desc" placeholder="DescriÃ§Ã£o do Produto" class="full-width">
                <input type="text" id="ref" placeholder="ReferÃªncia">
                <input type="number" id="qtd" placeholder="Quantidade">
                <input type="number" id="valor" placeholder="Valor UnitÃ¡rio (R$)">
                <input type="text" id="fornecedor" placeholder="Fornecedor">
                <input type="text" id="grupo" placeholder="Grupo/Categoria">
                <div style="display: flex; gap: 5px;" class="full-width">
                    <input type="text" id="barcode" placeholder="CÃ³digo de Barras" style="flex-grow: 1;">
                    <button class="btn-scan" onclick="iniciarScanner('cadastro')">ğŸ“·</button>
                </div>
                <button class="btn-add full-width" onclick="adicionarProduto()">ğŸ’¾ Confirmar Cadastro</button>
            </div>
        </div>
    </div>

    <table id="tabelaEstoque">
        <thead>
            <tr>
                <th>CÃ³d.</th>
                <th>DescriÃ§Ã£o</th>
                <th>Fornec./Grupo</th>
                <th>Qtd</th>
                <th>Valor</th>
                <th>Barras</th>
                <th>AÃ§Ãµes</th>
            </tr>
        </thead>
        <tbody id="listaProdutos"></tbody>
    </table>

    <button class="btn-pdf" onclick="gerarPDF()">ğŸ“„ Gerar RelatÃ³rio PDF</button>
</div>

<script src="script.js"></script>
</body>
</html>